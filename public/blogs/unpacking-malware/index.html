<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Unpacking Malware | Rahul Mishra</title>
<meta name=keywords content><meta name=description content="Malware Packing
Packing is like wrapping a program in layers to hide its contents. Malware authors use packers to compress or encrypt the original program and add a small unpacking stub. The stub is a tiny piece of code that runs first. When the packed file is executed, the stub decompresses (or decrypts) the real malicious code into memory and then hands control to it (courses.cs.umbc.edu ,redscan.com). This means on disk you only see a wrapper, not the actual malware."><meta name=author content="Me"><link rel=canonical href=//localhost:1313/blogs/unpacking-malware/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=//localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=//localhost:1313/apple-touch-icon.png><link rel=mask-icon href=//localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=//localhost:1313/blogs/unpacking-malware/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Unpacking Malware"><meta property="og:description" content="Malware Packing
Packing is like wrapping a program in layers to hide its contents. Malware authors use packers to compress or encrypt the original program and add a small unpacking stub. The stub is a tiny piece of code that runs first. When the packed file is executed, the stub decompresses (or decrypts) the real malicious code into memory and then hands control to it (courses.cs.umbc.edu ,redscan.com). This means on disk you only see a wrapper, not the actual malware."><meta property="og:type" content="article"><meta property="og:url" content="//localhost:1313/blogs/unpacking-malware/"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2025-05-10T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-10T00:00:00+00:00"><meta property="og:site_name" content="Rahul Mishra"><meta name=twitter:card content="summary"><meta name=twitter:title content="Unpacking Malware"><meta name=twitter:description content="Malware Packing
Packing is like wrapping a program in layers to hide its contents. Malware authors use packers to compress or encrypt the original program and add a small unpacking stub. The stub is a tiny piece of code that runs first. When the packed file is executed, the stub decompresses (or decrypts) the real malicious code into memory and then hands control to it (courses.cs.umbc.edu ,redscan.com). This means on disk you only see a wrapper, not the actual malware."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"//localhost:1313/blogs/"},{"@type":"ListItem","position":2,"name":"Unpacking Malware","item":"//localhost:1313/blogs/unpacking-malware/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Unpacking Malware","name":"Unpacking Malware","description":"Malware Packing\nPacking is like wrapping a program in layers to hide its contents. Malware authors use packers to compress or encrypt the original program and add a small unpacking stub. The stub is a tiny piece of code that runs first. When the packed file is executed, the stub decompresses (or decrypts) the real malicious code into memory and then hands control to it (courses.cs.umbc.edu ,redscan.com). This means on disk you only see a wrapper, not the actual malware.","keywords":[],"articleBody":"Malware Packing\nPacking is like wrapping a program in layers to hide its contents. Malware authors use packers to compress or encrypt the original program and add a small unpacking stub. The stub is a tiny piece of code that runs first. When the packed file is executed, the stub decompresses (or decrypts) the real malicious code into memory and then hands control to it (courses.cs.umbc.edu ,redscan.com). This means on disk you only see a wrapper, not the actual malware. Packing makes static analysis very hard, because the real code (and its strings or import table) stays hidden until runtime.\n‍\nImpact of Packing on Static Malware Analysis\nAnalysts only see the unpacking stub and seemingly random (high entropy) data. Readable strings, function names, and useful metadata are often missing or obfuscated. The Import Table is minimal or manipulated, hiding actual API calls. Section names and structures are altered (.text​ becomes UPX0​, etc.), making the file suspicious and harder to analyze statically. Disassemblers like Ghidra or IDA show misleading or incomplete code paths until the file is unpacked ‍\nImpact of packing on dynamic analysis\nWhen executed, the stub unpacks the real malware code into memory. Analysts can observe the real code after unpacking. Memory dumps after unpacking reveal the original malware. ‍\nPacking is like putting your program into a locked box.The box hides the real code, making it harder for defenders to read or change it.When you run the packed program, it first unpacks itself in memory, then does its real job.\nOriginal Program (on disk) +------------+-----------+ | .text (code) | .idata | | .rdata (.data) | | ... (other sections) | +------------------------+ Entry point here ⬇︎ Packed Program (on disk after packing) +----------------------+ | Stub (decompressor) | \u003c-- contains code to unpack | Compressed data | (the original code encrypted) | (filler/empty space) | +----------------------+ Entry point is at Stub ⬇︎ ‍\nThe packer takes the original executable (with its code, data, imports, etc.) and compresses or encrypts its contents. It then creates a new executable with a new header and stub. For example, UPX (a common packer) names its sections UPX0​, UPX1​, etc., instead of .text​ or .data​redscan.com​medium.com. The original entry point (OEP) of the program is replaced by the packer stub. This stub is a tiny loader program whose job is to restore the original program in memory7orvs.github.io courses.cs.umbc.edu.\n‍\nWhen you run the packed executable, the operating system loads this stub into memory and begins executing it. The stub allocates memory, decompresses or decrypts the original program into that space, and rebuilds the import table and other metadata.\nFinally, the stub jumps to the now-unpacked original entry point (OEP), transferring control to the real malware code.\n‍\nRuntime unpacking (in memory): [OS loads packed EXE] ---\u003e [Stub runs] | v Stub does: - Allocate memory space - Decompress original code into it - Fix up Import Table (using LoadLibrary/GetProcAddress) - Jump to Original Entry Point After this: [Memory: Original code runs] ‍\nRuntime Flow Diagram\nPacked EXE (disk) --\u003e Stub runs (allocates memory, unpacks code, fixes imports) --\u003e Original code executes in memory Runtime [Disk] [Memory after unpack] +------------+ +------------------+ | Stub code | -----\u003e | Unpacked .text | (Original code) | Compressed | | Unpacked .data | (Data restored) | data blob | | IAT rebuilt | (Imports resolved) +------------+ +------------------+ ‍\nUPX a common “packer” with built‑in “unpacker”\nUPX is a free tool that both packs and unpacks executables. To pack, you run upx \u003csample\u003e To unpack, you run:\nupx -d \u003csample\u003e ‍\nBut attackers can tweak packers so those tools break. We need a manual plan‑B to peel away the packing ourselves We will be analyzing a sample Brbbot.exe and perform static and dynamic analysis to understand it’s behaviour\n‍\n\u003e sha256sum brbbot.exe \u003e f9227a44ea25a7ee8148e2d0532b14bb640f6dc52cb5b22a9f4fa7fa037417fa brbbot.exe ‍\n‍\nThe malware is packed using UPX , we will discuss multiple ways to unpack this sample.\n‍\nResults From PEstudio\nSeeing NPX0/UPX0 and UPX1 is also a big hint you’ve got a UPX‐packed binary. This could be different incase of other packers used by the malware But a software packed using UPX has section names as UPX, UPX1. but here we have NPX0.\nThis has been done intentionally by the attacker, this way we wont be able to unpack it using the default method.\n‍\n┌─────────────────────────────┐ │ Packed EXE │ ├─────────────────────────────┤ │ Sections: │ │ ├── NPX0 (compressed code)│ │ └── UPX1 (unpacker stub) │ │ │ │ Imports: │ │ ├── Kernel32.VirtualProtect│ │ ├── Kernel32.LoadLibraryA │ │ └── Kernel32.GetProcAddress│ │ │ │ Strings: │ │ └── (Mostly none — │ │ data appears random) │ └─────────────────────────────┘ ‍\n‍\nupx -d \u003csample\u003e ‍\n‍\nUnpacking Using Binary Patching\nTo unpack this we can change the NPX0 to UPX0 in a Hexeditor.\n‍\n‍\n‍\n‍\nReplacing the values.\nbless brbbot.exe ‍\nsave the file , and unpack it using upx\nupx -d brbbot_patched.exe ‍\nUnpacked Binary(brbbot.exe)\nLegitimate executables use names like .text​, .rdata​, .data​ or .rsrc​.\n‍\n┌─────────────────────────────┐ │ Original EXE │ ├─────────────────────────────┤ │ Sections: │ │ ├── .text (code) │ │ ├── .data (data) │ │ └── .rdata (IAT, etc.) │ │ │ │ Imports: │ │ ├── Win32 APIs: │ │ │ - CreateFileA │ │ │ - send, recv │ │ │ - RegOpenKeyEx │ │ │ - ... │ │ │ │ Strings: │ │ ├── \"C:\\Windows\\...\" │ │ ├── \"http://malicious\" │ │ └── \"Hello, world\" │ └─────────────────────────────┘ ‍\nEntropy\n‍\nWhat is Entropy? A measure of randomness or disorder in data.\nRange: 0.0 (perfectly uniform—every byte the same) to 8.0 (perfectly random all 256 byte-values equally likely).\nNormal code/data isn’t purely random: machine-code opcodes, ASCII strings, import tables, resource blobs → entropy ≈ 5–6.\nCompressed/encrypted (packed) data looks random → entropy \u003e 7.5\n‍\nEntropy → 0.0 ─┬───────┬───────┬───────┬───────┬─ 8.0 1 3 5 7 8 │ low normal high(random) ‍\nPacked with UPX\n+--------+---------------+----------------+-------------------------------------------------------------+ | Section| Raw-Size | Virtual-Size | What this means | +--------+---------------+----------------+-------------------------------------------------------------+ | NPX0 | 0 bytes | 110,592 bytes | On disk it’s empty; Windows reserves ~108 KB in RAM | | | | | as a placeholder for unpacked code. | +--------+---------------+----------------+-------------------------------------------------------------+ | UPX1 | 34,816 bytes | 36,864 bytes | On disk holds the UPX-compressed blob; Windows maps ~36 KB | | | | | for it in memory, and its stub unpacks the real code into | | | | | the NPX0 section at runtime. | +--------+---------------+----------------+-------------------------------------------------------------+ ‍\nOn Disk: In Memory: +----------------------+ +----------------------+ | UPX1 │█████ (34K) | ─► | UPX1 │████ (36K) | | NPX0 │ (0K) | | NPX0 │████ (108K) | +----------------------+ +----------------------+ ‍\nNPX0 raw-size = 0\n→ There is no actual data on disk for that section.\nNPX0 virtual-size \u003e 0\n→ Windows will carve out that much space in RAM when you run the program.\nUPX1 raw-size \u003e 0\n→ This is the compressed blob the packer stub will execute.\nUPX1 virtual-size slightly larger due to section alignment rounding.+\n‍\n‍\nunpacking within memory\nWhen malware authors pack a program, they compress or encrypt the real payload, so it’s hidden in the file on disk. When the program runs, it unpacks itself in memory, and the real malicious code becomes visible only while it’s running.\nMost packers don’t encrypt memory after unpacking — they only hide content on disk. So by watching memory while the malware runs, you bypass the packing layer. This is a core dynamic analysis trick.\n‍\nWhat is ImageBase?\n‍\nWhen you compile a Windows program, the compiler writes a preferred load address into the EXE header called the ImageBase (e.g. ​0x140000000).\nThis is merely a suggestion to Windows: “Please load me at this address in memory.”\nIf ASLR is enabled, Windows can ignore the ImageBase suggestion and load the program at a random address each time it runs.\nIf ASLR is disabled, Windows will honor the ImageBase and load the program at that exact address.\n‍\nBut Why disable ASLR for unpacking?\nso we are going to open the specimen in CFF explorer —\u003e optional headers —\u003e click here\ndll characteristics : that is because originally dlls would have aslr but executables would not and then microsoft changes so both could have it\n‍\nCLick on file ---\u003e save ---\u003e overwirite the original file --\u003e yes ‍\nSo now your prorgam will run on image base, anytime it runs\nhttps://github.com/DidierStevens/DidierStevensSuite we can disable the DynamicBase flag using the command-line tool setdllcharacteristics by Didier Stevens. This tool is available as free. To disable the flag, invoke the tool with the -d parameter. ‍\nSTEPS TO VERIFY MALWARE IS UNPACKED IN MEMORY\nStep 1: Run the packed malware sample (malware.exe) [As Administrator, in a safe environment] Step 2: Open Process Hacker/any other tool [A tool like Task Manager but more powerful] Step 3: Find the brbbot.exe process Right-click \u003e Properties Step 4: Go to: Memory \u003e Strings... \u003e [Set \"Minimum length\" to 10] \u003e OK Step 5: Analyze the output Look at readable strings found in memory. These may not be visible in the packed EXE file itself. We ’re not reading the file on disk, We ’re reading the live memory of the process to get unpacked strings.\nWe want to dump (extract) the unpacked version of the malware from memory to a file, so we can analyze the real code statically.\n‍\nWhy Do We Dump from Memory?\n[On Disk: brbbot.exe] → Packed, obfuscated, unreadable ↓ [In Memory: Running Process] → Fully unpacked, real code visible! ↓ [Dump] → Save that clean, unpacked version to analyze ‍\nBut there is a problem: Dumped Executables Are Often Broken\nwe will be using Scylla a Windows tool used in reverse engineering to rebuild the Import Address Table (IAT) of a (Portable Executable) file.\nOpen Scylla64 and choose brbbot.exe, we are going to attach it, its very much like a debugger, with a debugger you can attach to a running program and start debugging it even though the program was already running we do the same thing with Scylla, we click on brbbot as our choice and down in the bottom theres a little log window.\n‍\n‍\n‍\n‍\nDumped EXEs Often Still Don’t Work\nEven after using Scylla to dump a process and fix the Import Address Table , the dumped file often crashes when you try to run it. Because the Entry Point still points to the unpacking stub the small bit of code that unpacks the real code into memory.\n‍\nBefore: Packed EXE on Disk\n+---------------------+ | .text (stub code) | ← Entry Point here (at the unpacking stub) +---------------------+ | Compressed Code | | Compressed Data | +---------------------+ | Import Table (fake) | +---------------------+ When loaded into memory, the stub runs, unpacks the real code, fixes imports dynamically, then jumps to the real OEP.\n‍\nAfter: Process is Unpacked in Memory\n+---------------------+ | Real Code in Memory | | Real OEP is here | ← We need to point EP to here! +---------------------+ | Real IAT (rebuilt) | +---------------------+ | .data, .rdata, etc. | +---------------------+ ‍\nAt this stage, everything is ready in memory, and Scylla can dump it. So we:\nAttach Scylla to this running process. Dump it to disk. Use “IAT Autosearch” to rebuild the Import Address Table. Click Dump. But… we forgot one thing!\n‍\nDumped EXE Still Points to Old Stub\nDumped EXE from Scylla: +-------------------------+ | Entry Point → Stub Code| ← ❌ This stub tries to unpack again +-------------------------+ | Real Code is here | | Real OEP is here | +-------------------------+ As a result: The dumped file crashes\n‍\nLets load the malware inside x64debug and find its entry point (unpacking stub)\n‍\n‍\n‍\nScylla comes as plugin for x64 debugger, we will use that for our work.\nAfter carefully dumping the process from memory and correcting its structure, we now have a clean, working executable that is ready for both static and dynamic analysis.\n‍\n","wordCount":"1998","inLanguage":"en","datePublished":"2025-05-10T00:00:00Z","dateModified":"2025-05-10T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"//localhost:1313/blogs/unpacking-malware/"},"publisher":{"@type":"Organization","name":"Rahul Mishra","logo":{"@type":"ImageObject","url":"//localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=//localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=//localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=//localhost:1313/blogs/ title=blogs><span>blogs</span></a></li><li><a href=//localhost:1313/projects/ title=projects><span>projects</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=//localhost:1313/blogs/>Blogs</a></div><h1 class="post-title entry-hint-parent">Unpacking Malware</h1><div class=post-meta><span title='2025-05-10 00:00:00 +0000 UTC'>May 10, 2025</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;1998 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/blogs/unpacking-malware.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p><strong>Malware Packing</strong></p><p><strong>Packing</strong> is like wrapping a program in layers to hide its contents. Malware authors use packers to <strong>compress or encrypt</strong> the original program and add a small <strong>unpacking stub</strong>. The stub is a tiny piece of code that runs first. When the packed file is executed, the stub <strong>decompresses</strong> (or decrypts) the real malicious code into memory and then hands control to it (<a href="https://courses.cs.umbc.edu/undergraduate/CMSC491malware/CMSC%20449%20-%20Lec3%20-%20Hashing%20and%20Packing.pdf#:~:text=%EF%82%A7%20Compress%20original%20program%20and,into%20memory%20and%20runs%20it">courses.cs.umbc.edu</a> ,<a href="https://www.redscan.com/news/redscan-labs-malware-unpacking-uncover-hidden-cyber-threats/#:~:text=Software%20packers%20function%20by%20compressing,a%20decoder%20stub%20for%20decompression">redscan.com</a>). This means on disk you only see a wrapper, not the actual malware. Packing makes static analysis very hard, because the real code (and its strings or import table) stays hidden until runtime.</p><p>‍</p><p><strong>Impact of Packing on Static Malware Analysis</strong></p><ul><li>Analysts only see the unpacking stub and seemingly random (high entropy) data.</li><li>Readable strings, function names, and useful metadata are often missing or obfuscated.</li><li>The Import Table is minimal or manipulated, hiding actual API calls.</li><li>Section names and structures are altered (<code>.text</code>​ becomes <code>UPX0</code>​, etc.), making the file suspicious and harder to analyze statically.</li><li>Disassemblers like Ghidra or IDA show misleading or incomplete code paths until the file is unpacked</li></ul><p>‍</p><p><strong>Impact of packing on dynamic analysis</strong></p><ul><li>When executed, the stub unpacks the real malware code into memory.</li><li>Analysts can observe the real code after unpacking.</li><li>Memory dumps after unpacking reveal the original malware.</li></ul><p>‍</p><p><strong>Packing</strong> is like putting your program into a locked box.The box hides the real code, making it harder for defenders to read or change it.When you run the packed program, it first <strong>unpacks</strong> itself in memory, then does its real job.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>Original</span><span class=w> </span><span class=n>Program</span><span class=w> </span><span class=p>(</span><span class=n>on</span><span class=w> </span><span class=n>disk</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>+------------+-----------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>.</span><span class=n>text</span><span class=w> </span><span class=p>(</span><span class=n>code</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=err>.</span><span class=n>idata</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>.</span><span class=n>rdata</span><span class=w> </span><span class=p>(</span><span class=err>.</span><span class=n>data</span><span class=p>)</span><span class=w>         </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=err>...</span><span class=w> </span><span class=p>(</span><span class=n>other</span><span class=w> </span><span class=n>sections</span><span class=p>)</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>+------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Entry</span><span class=w> </span><span class=n>point</span><span class=w> </span><span class=n>here</span><span class=w> </span><span class=err>⬇︎</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Packed</span><span class=w> </span><span class=n>Program</span><span class=w> </span><span class=p>(</span><span class=n>on</span><span class=w> </span><span class=n>disk</span><span class=w> </span><span class=n>after</span><span class=w> </span><span class=n>packing</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>+----------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Stub</span><span class=w> </span><span class=p>(</span><span class=n>decompressor</span><span class=p>)</span><span class=w>  </span><span class=o>|</span><span class=w>  </span><span class=o>&lt;--</span><span class=w> </span><span class=n>contains</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>unpack</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Compressed</span><span class=w> </span><span class=n>data</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=p>(</span><span class=n>the</span><span class=w> </span><span class=n>original</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=n>encrypted</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=p>(</span><span class=n>filler</span><span class=o>/</span><span class=n>empty</span><span class=w> </span><span class=n>space</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>+----------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Entry</span><span class=w> </span><span class=n>point</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>Stub</span><span class=w> </span><span class=err>⬇︎</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p>The packer takes the original executable (with its code, data, imports, etc.) and <strong>compresses or encrypts</strong> its contents. It then creates a new executable with a <strong>new header and stub</strong>. For example, UPX (a common packer) names its sections <code>UPX0</code>​, <code>UPX1</code>​, etc., instead of <code>.text</code>​ or <code>.data</code>​<a href="https://www.redscan.com/news/redscan-labs-malware-unpacking-uncover-hidden-cyber-threats/#:~:text=The%20next%20image%20shows%20sections,109%20Image%3A%20How%20to">redscan.com</a>​<a href="https://medium.com/ax1al/packing-and-obfuscation-fe6b03bbc267#:~:text=Upx%20is%20commonly%20used%20packer,3%20main%20part%20which%20are">medium.com</a>. The original entry point (OEP) of the program is replaced by the packer stub. This stub is a tiny loader program whose job is to restore the original program in memory<a href="https://7orvs.github.io/tutorials%20summaries/packing-notes-part1/#:~:text=A%20,to%20decrypt%20the%20packed%20file">7orvs.github.io</a> <a href="https://courses.cs.umbc.edu/undergraduate/CMSC491malware/CMSC%20449%20-%20Lec3%20-%20Hashing%20and%20Packing.pdf#:~:text=%EF%82%A7%20Compress%20original%20program%20and,into%20memory%20and%20runs%20it">courses.cs.umbc.edu</a>.</p><p>‍</p><p>When you run the packed executable, the operating system loads this stub into memory and begins executing it. The stub allocates memory, decompresses or decrypts the original program into that space, and rebuilds the import table and other metadata.</p><p>Finally, the stub jumps to the now-unpacked original entry point (OEP), transferring control to the real malware code.</p><p>‍</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>Runtime</span><span class=w> </span><span class=n>unpacking</span><span class=w> </span><span class=p>(</span><span class=n>in</span><span class=w> </span><span class=n>memory</span><span class=p>)</span><span class=err>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>[</span><span class=n>OS</span><span class=w> </span><span class=n>loads</span><span class=w> </span><span class=n>packed</span><span class=w> </span><span class=n>EXE</span><span class=p>]</span><span class=w> </span><span class=o>---&gt;</span><span class=w> </span><span class=p>[</span><span class=n>Stub</span><span class=w> </span><span class=n>runs</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>v</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Stub</span><span class=w> </span><span class=n>does</span><span class=err>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>Allocate</span><span class=w> </span><span class=n>memory</span><span class=w> </span><span class=n>space</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>Decompress</span><span class=w> </span><span class=n>original</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=n>it</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>Fix</span><span class=w> </span><span class=n>up</span><span class=w> </span><span class=n>Import</span><span class=w> </span><span class=n>Table</span><span class=w> </span><span class=p>(</span><span class=n>using</span><span class=w> </span><span class=n>LoadLibrary</span><span class=o>/</span><span class=n>GetProcAddress</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>Jump</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>Original</span><span class=w> </span><span class=n>Entry</span><span class=w> </span><span class=n>Point</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>After</span><span class=w> </span><span class=n>this</span><span class=err>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>[</span><span class=n>Memory</span><span class=err>:</span><span class=w> </span><span class=n>Original</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=n>runs</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p><strong>Runtime Flow Diagram</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>Packed</span><span class=w> </span><span class=n>EXE</span><span class=w> </span><span class=p>(</span><span class=n>disk</span><span class=p>)</span><span class=w> </span><span class=o>--&gt;</span><span class=w> </span><span class=n>Stub</span><span class=w> </span><span class=n>runs</span><span class=w> </span><span class=p>(</span><span class=n>allocates</span><span class=w> </span><span class=n>memory</span><span class=p>,</span><span class=w> </span><span class=n>unpacks</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>fixes</span><span class=w> </span><span class=n>imports</span><span class=p>)</span><span class=w> </span><span class=o>--&gt;</span><span class=w> </span><span class=n>Original</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=n>executes</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=n>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>Runtime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>[</span><span class=n>Disk</span><span class=p>]</span><span class=w>               </span><span class=p>[</span><span class=n>Memory</span><span class=w> </span><span class=n>after</span><span class=w> </span><span class=n>unpack</span><span class=p>]</span><span class=w>               
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>+------------+</span><span class=w>        </span><span class=o>+------------------+</span><span class=w>                  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Stub</span><span class=w> </span><span class=n>code</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=o>-----&gt;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Unpacked</span><span class=w> </span><span class=err>.</span><span class=n>text</span><span class=w>   </span><span class=o>|</span><span class=w>  </span><span class=p>(</span><span class=n>Original</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>Compressed</span><span class=w> </span><span class=o>|</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>Unpacked</span><span class=w> </span><span class=err>.</span><span class=n>data</span><span class=w>   </span><span class=o>|</span><span class=w>  </span><span class=p>(</span><span class=n>Data</span><span class=w> </span><span class=n>restored</span><span class=p>)</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=n>blob</span><span class=w>  </span><span class=o>|</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>IAT</span><span class=w> </span><span class=n>rebuilt</span><span class=w>      </span><span class=o>|</span><span class=w>  </span><span class=p>(</span><span class=n>Imports</span><span class=w> </span><span class=n>resolved</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>+------------+</span><span class=w>        </span><span class=o>+------------------+</span><span class=w>                  
</span></span></span></code></pre></div><p>‍</p><p><strong>UPX a common “packer” with built‑in “unpacker”</strong></p><ul><li><strong>UPX</strong> is a free tool that both packs and unpacks executables.</li><li>To <strong>pack</strong>, you run</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>upx</span><span class=w> </span><span class=o>&lt;</span><span class=n>sample</span><span class=o>&gt;</span><span class=w>  
</span></span></span></code></pre></div><p>To <strong>unpack</strong>, you run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>upx</span><span class=w> </span><span class=o>-</span><span class=n>d</span><span class=w> </span><span class=o>&lt;</span><span class=n>sample</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><ul><li>But <strong>attackers</strong> can tweak packers so those tools break.</li><li>We need a <strong>manual</strong> plan‑B to peel away the packing ourselves</li></ul><hr><p><strong>We will be analyzing a sample</strong> <strong>Brbbot.exe</strong> <strong>and perform static and dynamic analysis to understand it’s behaviour</strong></p><p>‍</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=o>&gt;</span><span class=w> </span><span class=n>sha256sum</span><span class=w> </span><span class=n>brbbot</span><span class=err>.</span><span class=n>exe</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&gt;</span><span class=w> </span><span class=n>f9227a44ea25a7ee8148e2d0532b14bb640f6dc52cb5b22a9f4fa7fa037417fa</span><span class=w>  </span><span class=n>brbbot</span><span class=err>.</span><span class=n>exe</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509192822-fdctpkw.png></p><p>‍</p><p><strong>The malware is packed using UPX , we will discuss multiple ways to unpack this sample.</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509140035-85futps.png></p><p>‍</p><p><strong>Results From PEstudio</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509135757-euwv2yy.png></p><p>Seeing NPX0/UPX0 and UPX1 is also a big hint you’ve got a UPX‐packed binary. This could be different incase of other packers used by the malware But a software packed using UPX has section names as UPX, UPX1. but here we have <strong>NPX0.</strong></p><p>This has been done intentionally by the attacker, this way we wont be able to unpack it using the default method.</p><p>‍</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=err>┌─────────────────────────────┐</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>         </span><span class=n>Packed</span><span class=w> </span><span class=n>EXE</span><span class=w>          </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>├─────────────────────────────┤</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=n>Sections</span><span class=err>:</span><span class=w>                   </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=n>NPX0</span><span class=w>  </span><span class=p>(</span><span class=n>compressed</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>└──</span><span class=w> </span><span class=n>UPX1</span><span class=w>  </span><span class=p>(</span><span class=n>unpacker</span><span class=w> </span><span class=n>stub</span><span class=p>)</span><span class=w>  </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>                             </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=n>Imports</span><span class=err>:</span><span class=w>                    </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=n>Kernel32</span><span class=err>.</span><span class=n>VirtualProtect</span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=n>Kernel32</span><span class=err>.</span><span class=n>LoadLibraryA</span><span class=w>  </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>└──</span><span class=w> </span><span class=n>Kernel32</span><span class=err>.</span><span class=n>GetProcAddress</span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>                             </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=n>Strings</span><span class=err>:</span><span class=w>                    </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>└──</span><span class=w> </span><span class=p>(</span><span class=n>Mostly</span><span class=w> </span><span class=n>none</span><span class=w> </span><span class=err>—</span><span class=w>         </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>       </span><span class=n>data</span><span class=w> </span><span class=n>appears</span><span class=w> </span><span class=n>random</span><span class=p>)</span><span class=w>  </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>└─────────────────────────────┘</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p>‍</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>upx</span><span class=w> </span><span class=o>-</span><span class=n>d</span><span class=w> </span><span class=o>&lt;</span><span class=n>sample</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509140413-ehalqqg.png></p><p>‍</p><p><strong>Unpacking Using Binary Patching</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509140820-qjn3ka5.png></p><p><strong>To unpack this we can change the NPX0 to UPX0 in a Hexeditor.</strong></p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509142827-24czzhs.png></p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509142612-uvj4v1a.png></p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509143027-6ituq3v.png></p><p>‍</p><p><strong>Replacing the values.</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>bless</span><span class=w> </span><span class=n>brbbot</span><span class=err>.</span><span class=n>exe</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250509144206-k295d9y.png></p><p>save the file , and unpack it using upx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>upx</span><span class=w> </span><span class=o>-</span><span class=n>d</span><span class=w> </span><span class=nv>brbbot_patched</span><span class=err>.</span><span class=n>exe</span><span class=w> 
</span></span></span></code></pre></div><p>‍</p><p><strong>Unpacked Binary(brbbot.exe)</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250428211915-3irv46p.png></p><p>Legitimate executables use names like <code>.text</code>​, <code>.rdata</code>​, <code>.data</code>​ or <code>.rsrc</code>​.</p><p>‍</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=err>┌─────────────────────────────┐</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>        </span><span class=n>Original</span><span class=w> </span><span class=n>EXE</span><span class=w>         </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>├─────────────────────────────┤</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=n>Sections</span><span class=err>:</span><span class=w>                   </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=err>.</span><span class=n>text</span><span class=w>     </span><span class=p>(</span><span class=n>code</span><span class=p>)</span><span class=w>       </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=err>.</span><span class=n>data</span><span class=w>     </span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=w>       </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>└──</span><span class=w> </span><span class=err>.</span><span class=n>rdata</span><span class=w>    </span><span class=p>(</span><span class=n>IAT</span><span class=p>,</span><span class=w> </span><span class=n>etc</span><span class=err>.</span><span class=p>)</span><span class=w>  </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>                             </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=n>Imports</span><span class=err>:</span><span class=w>                    </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=n>Win32</span><span class=w> </span><span class=n>APIs</span><span class=err>:</span><span class=w>            </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>│</span><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>CreateFileA</span><span class=w>         </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>│</span><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>send</span><span class=p>,</span><span class=w> </span><span class=n>recv</span><span class=w>          </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>│</span><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>RegOpenKeyEx</span><span class=w>        </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>│</span><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=err>...</span><span class=w>                 </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>                             </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=n>Strings</span><span class=err>:</span><span class=w>                    </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=s>&#34;C:\Windows\...&#34;</span><span class=w>       </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>├──</span><span class=w> </span><span class=s>&#34;http://malicious&#34;</span><span class=w>     </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w>  </span><span class=err>└──</span><span class=w> </span><span class=s>&#34;Hello, world&#34;</span><span class=w>         </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>└─────────────────────────────┘</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p><strong>Entropy</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250428213521-btkg0vc.png></p><p>‍</p><h3 id=span-data-typetext-stylefont-size-20pxwhat-is-entropyspan>What is Entropy?<a hidden class=anchor aria-hidden=true href=#span-data-typetext-stylefont-size-20pxwhat-is-entropyspan>#</a></h3><ul><li><p>A measure of <strong>randomness</strong> or <strong>disorder</strong> in data.</p></li><li><p><strong>Range</strong>: 0.0 (perfectly uniform—every byte the same) to 8.0 (perfectly random all 256 byte-values equally likely).</p></li><li><p><strong>Normal code/data</strong> isn’t purely random: machine-code opcodes, ASCII strings, import tables, resource blobs → <strong>entropy ≈ 5–6</strong>.</p></li><li><p><strong>Compressed/encrypted</strong> (packed) data looks random → <strong>entropy</strong> <strong>></strong> <strong>7.5</strong></p></li></ul><p>‍</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>Entropy</span><span class=w> </span><span class=err>→</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mf>0.0</span><span class=w> </span><span class=err>─┬───────┬───────┬───────┬───────┬─</span><span class=w> </span><span class=mf>8.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=mi>1</span><span class=w>       </span><span class=mi>3</span><span class=w>       </span><span class=mi>5</span><span class=w>       </span><span class=mi>7</span><span class=w>       </span><span class=mi>8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=err>│</span><span class=w>   </span><span class=n>low</span><span class=w>    </span><span class=n>normal</span><span class=w>    </span><span class=n>high</span><span class=p>(</span><span class=n>random</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p><strong>Packed with UPX</strong></p><pre tabindex=0><code class=language-pgsql data-lang=pgsql>+--------+---------------+----------------+-------------------------------------------------------------+
| Section|   Raw-Size    |  Virtual-Size  | What this means                                             |
+--------+---------------+----------------+-------------------------------------------------------------+
| NPX0   |     0 bytes   | 110,592 bytes  | On disk it’s empty; Windows reserves ~108 KB in RAM         |
|        |               |                | as a placeholder for unpacked code.                         |
+--------+---------------+----------------+-------------------------------------------------------------+
| UPX1   |  34,816 bytes |  36,864 bytes  | On disk holds the UPX-compressed blob; Windows maps ~36 KB  |
|        |               |                | for it in memory, and its stub unpacks the real code into   |
|        |               |                | the NPX0 section at runtime.                                |
+--------+---------------+----------------+-------------------------------------------------------------+
</code></pre><p>‍</p><pre tabindex=0><code class=language-pgsql data-lang=pgsql>On Disk:                     In Memory:
+----------------------+     +----------------------+
| UPX1 │█████ (34K)    |  ─► | UPX1 │████ (36K)     |
| NPX0 │      (0K)     |     | NPX0 │████ (108K)    |
+----------------------+     +----------------------+
</code></pre><p>‍</p><ul><li><p><strong>NPX0 raw-size</strong> <strong>=</strong> <strong>0</strong><br>→ There is <em>no actual data</em> on disk for that section.</p></li><li><p><strong>NPX0 virtual-size</strong> <strong>></strong> <strong>0</strong><br>→ Windows will carve out that much space in RAM when you run the program.</p></li><li><p><strong>UPX1 raw-size</strong> <strong>></strong> <strong>0</strong><br>→ This is the compressed blob the packer stub will execute.</p></li><li><p><strong>UPX1 virtual-size</strong> slightly larger due to section alignment rounding.+</p></li></ul><p>‍</p><p>‍</p><p><strong>unpacking within memory</strong></p><p><em><strong>When malware authors pack a program, they compress or encrypt the real payload, so it&rsquo;s hidden in the file on disk. When the program runs, it unpacks itself in memory, and the real malicious code becomes visible only while it&rsquo;s running.</strong></em></p><p>Most packers don&rsquo;t encrypt memory after unpacking — they only hide content on disk. So by watching memory while the malware runs, you bypass the packing layer. This is a core dynamic analysis trick.</p><p>‍</p><p><strong>What is ImageBase?</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250429105955-t4mk3wh.png></p><p>‍</p><ul><li><p>When you compile a Windows program, the compiler writes a <strong>preferred load address</strong> into the EXE header called the <strong>ImageBase</strong> (e.g. ​0x140000000).</p></li><li><p>This is merely a <strong>suggestion</strong> to Windows: “Please load me at this address in memory.”</p></li><li><p>If ASLR is <strong>enabled</strong>, Windows can <strong>ignore</strong> the ImageBase suggestion and load the program at a <strong>random</strong> address each time it runs.</p></li><li><p>If ASLR is <strong>disabled</strong>, Windows will honor the ImageBase and load the program at that exact address.</p></li></ul><p>‍</p><p><strong>But Why disable ASLR for unpacking?</strong></p><p><em><strong>so we are going to open the specimen in CFF explorer &mdash;> optional headers &mdash;> click here</strong></em></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250429111218-uiua79h.png></p><p>dll characteristics : that is because originally dlls would have aslr but executables would not and then microsoft changes so both could have it</p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250429111723-6pblclx.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>CLick</span><span class=w> </span><span class=n>on</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>---&gt;</span><span class=w> </span><span class=n>save</span><span class=w> </span><span class=o>---&gt;</span><span class=w> </span><span class=n>overwirite</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>original</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>--&gt;</span><span class=w> </span><span class=n>yes</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p>So now your prorgam will run on image base, anytime it runs</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>https</span><span class=err>:</span><span class=o>//</span><span class=n>github</span><span class=err>.</span><span class=n>com</span><span class=o>/</span><span class=n>DidierStevens</span><span class=o>/</span><span class=n>DidierStevensSuite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>we</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>disable</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>DynamicBase</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=n>using</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>command</span><span class=o>-</span><span class=n>line</span><span class=w> </span><span class=n>tool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>setdllcharacteristics</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=n>Didier</span><span class=w> </span><span class=n>Stevens</span><span class=err>.</span><span class=w> </span><span class=n>This</span><span class=w> </span><span class=n>tool</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>available</span><span class=w> </span><span class=n>as</span><span class=w> </span><span class=n>free</span><span class=err>.</span><span class=w> </span><span class=n>To</span><span class=w> </span><span class=n>disable</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>flag</span><span class=p>,</span><span class=w> </span><span class=n>invoke</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>tool</span><span class=w> </span><span class=n>with</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=o>-</span><span class=n>d</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>parameter</span><span class=err>.</span><span class=w>
</span></span></span></code></pre></div><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250430195813-8aofp6z.png></p><p>‍</p><p><strong>STEPS TO VERIFY MALWARE IS UNPACKED IN MEMORY</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>Step 1: Run the packed malware sample (malware.exe)
</span></span><span class=line><span class=cl>        [As Administrator, in a safe  environment]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Step 2: Open Process Hacker/any other tool
</span></span><span class=line><span class=cl>        [A tool like Task Manager but more powerful]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Step 3: Find the brbbot.exe process
</span></span><span class=line><span class=cl>        Right-click &gt; Properties
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Step 4: Go to:
</span></span><span class=line><span class=cl>        Memory &gt; Strings... &gt; [Set &#34;Minimum length&#34; to 10] &gt; OK
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Step 5: Analyze the output
</span></span><span class=line><span class=cl>        Look at readable strings found in memory.
</span></span><span class=line><span class=cl>        These may not be visible in the packed EXE file itself.
</span></span></code></pre></div><p>We ’re <strong>not reading the file on disk</strong>, We &rsquo;re <strong>reading the live memory</strong> of the process to get unpacked strings.</p><p>We want to <strong>dump (extract)</strong> the unpacked version of the malware from <strong>memory</strong> to a file, so we can analyze the real code statically.</p><p>‍</p><p><strong>Why Do We Dump from Memory?</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>[On Disk: brbbot.exe] → Packed, obfuscated, unreadable
</span></span><span class=line><span class=cl>            ↓
</span></span><span class=line><span class=cl>[In Memory: Running Process] → Fully unpacked, real code visible!
</span></span><span class=line><span class=cl>            ↓
</span></span><span class=line><span class=cl>[Dump] → Save that clean, unpacked version to analyze
</span></span></code></pre></div><p>‍</p><p><em><strong>But there is a problem: Dumped Executables Are Often Broken</strong></em></p><p>we will be using Scylla a <strong>Windows tool</strong> used in reverse engineering to <strong>rebuild the Import Address Table (IAT)</strong> of a (Portable Executable) file.</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250430114230-zsg4men.png></p><p>Open Scylla64 and choose brbbot.exe, we are going to attach it, its very much like a debugger, with a debugger you can attach to a running program and start debugging it even though the program was already running we do the same thing with Scylla, we click on brbbot as our choice and down in the bottom theres a little log window.</p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250430114629-etpcg0o.png></p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250430120136-44v205i.png></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250430120206-hhsxov3.png></p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250430121108-h0x0jos.png></p><p>‍</p><p><strong>Dumped EXEs Often Still Don’t Work</strong></p><p>Even after using Scylla to dump a process and fix the Import Address Table , the dumped file often crashes when you try to run it. Because the <strong>Entry Point</strong> still points to the <strong>unpacking stub</strong> the small bit of code that unpacks the real code into memory.</p><p>‍</p><p>Before: Packed EXE on Disk</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=o>+---------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>.</span><span class=n>text</span><span class=w> </span><span class=p>(</span><span class=n>stub</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w>   </span><span class=o>|</span><span class=w>  </span><span class=err>←</span><span class=w> </span><span class=n>Entry</span><span class=w> </span><span class=n>Point</span><span class=w> </span><span class=n>here</span><span class=w> </span><span class=p>(</span><span class=n>at</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>unpacking</span><span class=w> </span><span class=n>stub</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Compressed</span><span class=w> </span><span class=n>Code</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Compressed</span><span class=w> </span><span class=n>Data</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Import</span><span class=w> </span><span class=n>Table</span><span class=w> </span><span class=p>(</span><span class=n>fake</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------------+</span><span class=w>
</span></span></span></code></pre></div><p>When loaded into memory, the stub runs, unpacks the real code, fixes imports dynamically, then jumps to the real OEP.</p><p>‍</p><p>After: Process is Unpacked in Memory</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=o>+---------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Real</span><span class=w> </span><span class=n>Code</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=n>Memory</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Real</span><span class=w> </span><span class=n>OEP</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>here</span><span class=w>    </span><span class=o>|</span><span class=w>  </span><span class=err>←</span><span class=w> </span><span class=n>We</span><span class=w> </span><span class=n>need</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>point</span><span class=w> </span><span class=n>EP</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>here</span><span class=o>!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Real</span><span class=w> </span><span class=n>IAT</span><span class=w> </span><span class=p>(</span><span class=n>rebuilt</span><span class=p>)</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=err>.</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=err>.</span><span class=n>rdata</span><span class=p>,</span><span class=w> </span><span class=n>etc</span><span class=err>.</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+---------------------+</span><span class=w>
</span></span></span></code></pre></div><p>‍</p><p>At this stage, everything is <strong>ready in memory</strong>, and Scylla can dump it. So we:</p><ol><li>Attach Scylla to this running process.</li><li>Dump it to disk.</li><li>Use “IAT Autosearch” to rebuild the Import Address Table.</li><li>Click <strong>Dump</strong>.</li></ol><p>But&mldr; we <strong>forgot one thing!</strong></p><p>‍</p><p><strong>Dumped EXE Still Points to Old Stub</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mathematica data-lang=mathematica><span class=line><span class=cl><span class=n>Dumped</span><span class=w> </span><span class=n>EXE</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>Scylla</span><span class=err>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Entry</span><span class=w> </span><span class=n>Point</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>Stub</span><span class=w> </span><span class=n>Code</span><span class=o>|</span><span class=w>  </span><span class=err>←</span><span class=w> </span><span class=err>❌</span><span class=w> </span><span class=n>This</span><span class=w> </span><span class=n>stub</span><span class=w> </span><span class=n>tries</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>unpack</span><span class=w> </span><span class=n>again</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------------------------+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Real</span><span class=w> </span><span class=n>Code</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>here</span><span class=w>       </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Real</span><span class=w> </span><span class=n>OEP</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>here</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+-------------------------+</span><span class=w>
</span></span></span></code></pre></div><p>As a result: The dumped file crashes</p><p>‍</p><p><strong>Lets load the malware inside</strong> <strong>x64debug</strong> <strong>and find its entry point (unpacking stub)</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250507090509-epx5jbi.png></p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250507090650-zsh3rlg.png></p><p>‍</p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250507090808-h0t8gmy.png></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250507090911-iluayv2.png></p><p>‍</p><p><strong>Scylla comes as plugin for x64 debugger, we will use that for our work.</strong></p><p><img alt=image loading=lazy src=/blogs/unpacking-malware/image-20250507091002-2c6off3.png></p><p>After carefully dumping the process from memory and correcting its structure, we now have a <strong>clean, working executable</strong> that is ready for both static and dynamic analysis.</p><p>‍</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=//localhost:1313/blogs/return-to-mprotect/><span class=title>« Prev</span><br><span>Return to mprotect (defeating NX)</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Unpacking Malware on x" href="https://x.com/intent/tweet/?text=Unpacking%20Malware&amp;url=%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unpacking Malware on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f&amp;title=Unpacking%20Malware&amp;summary=Unpacking%20Malware&amp;source=%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unpacking Malware on reddit" href="https://reddit.com/submit?url=%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f&title=Unpacking%20Malware"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unpacking Malware on facebook" href="https://facebook.com/sharer/sharer.php?u=%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unpacking Malware on whatsapp" href="https://api.whatsapp.com/send?text=Unpacking%20Malware%20-%20%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unpacking Malware on telegram" href="https://telegram.me/share/url?text=Unpacking%20Malware&amp;url=%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unpacking Malware on ycombinator" href="https://news.ycombinator.com/submitlink?t=Unpacking%20Malware&u=%2f%2flocalhost%3a1313%2fblogs%2funpacking-malware%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=//localhost:1313/>Rahul Mishra</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>